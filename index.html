<!DOCTYPE html>
<html>
<head>
  <title>Music Venue Parser</title>
</head>
<body>
  <h1>Music Venue Information Parser</h1>

  <form id="uploadForm">
    <label for="file">Upload HTML file</label><br>
    <input id="fileUpload" name="fileUpload" type="file" /><br>
    <label for="tableClass">Country:</label>
    <input id="country" name="country" type="text" placeholder="Enter country" value="New Zealand"><br>
    <label for="tableClass">Table class:</label>
    <input id="tableClass" name="tableClass" type="text" placeholder="Enter table class" value="table-charts"><br>
    <button type="submit">Parse</button>
  </form>

  <script>
    document.getElementById('uploadForm').addEventListener('submit', function(event) {
      event.preventDefault();

      const fileInput = document.getElementById('fileUpload');
      const file = fileInput.files[0];

      if (!file) {
        alert('Please select a file.');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(event) {
        const fileContent = event.target.result;
        parseHTMLFile(fileContent);
      };
      reader.readAsText(file);
    });

    //console.log(htmlContent)

    function parseHTMLFile(htmlContent) {
      const parser = new DOMParser();
      const doc = parser.parseFromString(htmlContent, 'text/html');
      const tableClass = document.getElementById('tableClass').value.trim();
      const table = doc.querySelectorAll('table.' + tableClass);

      if (!table || table.length === 0) {
        displayResult('No tables found with class \"${tableClass}\" in the HTML file submitted.');
        return;
      }

      const results = Array.from(table).map(table => {
        return Array.from(table.querySelectorAll('tr')).map(row => {
          return Array.from(row.querySelectorAll('td div.entity')).map(cell => {
            const buttonElements = cell.querySelectorAll('button.btn-follow');
            buttonElements.forEach(button => {
              button.remove();
            });

            const articleElement = cell.querySelector('article');
            let venueName = "";
            let venueLocation = "";

            if (articleElement) {
              venueName = articleElement.querySelector('a h3').textContent.trim();
              venueLocation = articleElement.querySelector('a.location').textContent.trim();
            }

            console.log("venueName: " + venueName);
            console.log("venueLocation: " + venueLocation);

            // return ''; // Assuming you're returning an empty string here, modify as needed
          }).join(';');
        }).join('\n');
      });


      // Displaying formatted results
      displayResult(results);
    }

    function displayResult(result) {
      const resultElement = document.getElementById('result');
      resultElement.textContent = result;
    }
  </script>

  <h2>Parsed Results</h2>
  <pre id="result"></pre>
</body>
</html>